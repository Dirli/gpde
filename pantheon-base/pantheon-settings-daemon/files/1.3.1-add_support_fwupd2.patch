diff --git a/meson.build b/meson.build
index fb1b953..933c84e 100644
--- a/meson.build
+++ b/meson.build
@@ -12,6 +12,10 @@ granite_dep = dependency('granite', version: '>= 5.3.0')
 i18n = import('i18n')
 gettext_name = meson.project_name()
 
+if fwupd_dep.version().version_compare('>=2.0.0')
+    add_project_arguments('--define', 'HAS_FWUPD_2_0', language: 'vala')
+endif
+
 add_project_arguments(
     '-DGETTEXT_PACKAGE="@0@"'.format(gettext_name),
     language:'c'
diff --git a/src/Application.vala b/src/Application.vala
index b733624..e9fdd07 100644
--- a/src/Application.vala
+++ b/src/Application.vala
@@ -61,23 +61,28 @@ public class SettingsDaemon.Application : GLib.Application {
             var num_updates = 0;
             try {
                 var devices = fwupd_client.get_devices ();
-                for (int i = 0; i < devices.length; i++) {
-                    var device = devices[i];
-                    if (device.has_flag (Fwupd.DEVICE_FLAG_UPDATABLE)) {
-                        Fwupd.Release? release = null;
-                        try {
-                            var upgrades = fwupd_client.get_upgrades (device.get_id ());
-
-                            if (upgrades != null) {
-                                release = upgrades[0];
-                            }
-                        } catch (Error e) {
-                            warning (e.message);
-                        }
+                foreach (unowned var device in devices) {
+#if HAS_FWUPD_2_0
+                    if (!device.has_flag (Fwupd.DeviceFlags.UPDATABLE)) {
+#else
+                    if (!device.has_flag (Fwupd.DEVICE_FLAG_UPDATABLE)) {
+#endif
+                        continue;
+                    }
+
+                    Fwupd.Release? release = null;
+                    try {
+                        var upgrades = fwupd_client.get_upgrades (device.get_id ());
 
-                        if (release != null && device.get_version () != release.get_version ()) {
-                            num_updates++;
+                        if (upgrades != null) {
+                            release = upgrades[0];
                         }
+                    } catch (Error e) {
+                        warning (e.message);
+                    }
+
+                    if (release != null && device.get_version () != release.get_version ()) {
+                        num_updates++;
                     }
                 }
             } catch (Error e) {
