diff --git a/meson.build b/meson.build
index ee2df84..3449168 100644
--- a/meson.build
+++ b/meson.build
@@ -13,11 +13,17 @@ glib_dep = dependency('glib-2.0')
 gobject_dep = dependency('gobject-2.0')
 gio_dep = dependency('gio-2.0')
 gtk_dep = dependency('gtk+-3.0')
-gdk_dep = [ dependency('gdk-x11-3.0'), dependency('gdk-wayland-3.0') ]
+gdk_dep = [ dependency('gdk-x11-3.0') ]
 x11_dep = dependency('x11')
 granite_dep = dependency('granite')
 handy_dep = dependency('libhandy-1')
 
+wayland_dep = dependency('gdk-wayland-3.0', required: false)
+if wayland_dep.found()
+    gdk_dep += wayland_dep
+    add_project_arguments('--define=WAYLAND_USE', language: 'vala')
+endif
+
 add_project_arguments(
     '--vapidir', meson.current_source_dir() / 'vapi',
     language: 'vala'
diff --git a/src/ExternalWindow.vala b/src/ExternalWindow.vala
index ab28219..75609fd 100644
--- a/src/ExternalWindow.vala
+++ b/src/ExternalWindow.vala
@@ -29,8 +29,10 @@ public interface ExternalWindow : GLib.Object {
 
         if (handle.has_prefix (X11_PREFIX)) {
             external_window = new ExternalWindowX11 (handle.substring (X11_PREFIX.length));
+#if WAYLAND_USE
         } else if (handle.has_prefix (WAYLAND_PREFIX)) {
             external_window = new ExternalWindowWayland (handle.substring (WAYLAND_PREFIX.length));
+#endif
         } else {
             throw new IOError.FAILED ("Unhandled window type");
         }
@@ -93,7 +95,7 @@ public class ExternalWindowX11 : ExternalWindow, GLib.Object {
         );
     }
 }
-
+#if WAYLAND_USE
 public class ExternalWindowWayland : ExternalWindow, GLib.Object {
     private static Gdk.Display? wayland_display = null;
 
@@ -130,3 +132,4 @@ public class ExternalWindowWayland : ExternalWindow, GLib.Object {
         }
     }
 }
+#endif
